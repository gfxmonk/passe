#!bash -eu
set -o pipefail

git_meta="../../.git"
gup -u ../../VERSION
if [ -e $git_meta ]; then
	gup -u $git_meta/refs/heads/master
	commit="Some \"$(git rev-parse HEAD | cut -c -10)\""
else
	gup --ifcreate $git_meta
	commit="None"
fi

cat >"$1" <<EOF
let version="$(cat ../../VERSION)"
let commit = $commit
let pretty () = match commit with
	| Some c -> version ^ "-" ^ c
	| None -> version
EOF

gup --contents "$1"
