#!/bin/bash
set -eu
set -o pipefail
cd ../../../../src/www
pwd
gup --always
res="res"
gup -u "$res/all"
files="$(find -L "$res" -type f | grep -Fv '.gup/')"
num_files="$(echo "$files" | wc -l)"
if [ "$num_files" -lt 3 ]; then
	echo "no files found: $files" >&2
	exit 1
fi
cat > "$1" <<EOF
; NOTE: auto-generated by \`gup\`, do not edit manually
(install (
	(package passe-server)
	(section share)
	(files (
$(echo "$files" | while read f; do
	echo "		(\"$f\" as \"$f\")"
done)
	))
))
EOF
